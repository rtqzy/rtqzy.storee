<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rtqzy AI Chat - ChatGPT Style</title>
<style>
  /* Reset & fonts */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
  :root {
    --background-light: #ffffff;
    --background-dark: #0f1116;
    --sidebar-bg-light: #f7f7f8;
    --sidebar-bg-dark: #202123;
    --text-light: #000000;
    --text-dark: #e6e6e6;
    --primary: #10a37f;
    --input-bg-light: #f2f2f2;
    --input-bg-dark: #2a2b32;
    --bubble-user-light: #10a37f;
    --bubble-user-dark: #2a2b32;
    --bubble-bot-light: #e5e5ea;
    --bubble-bot-dark: #3a3b42;
  }
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
      Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    background: var(--background-light);
    color: var(--text-light);
    transition: background 0.3s, color 0.3s;
  }
  html[data-theme='dark'], body[data-theme='dark'] {
    background: var(--background-dark);
    color: var(--text-dark);
  }

  /* Layout */
  #app {
    display: flex; height: 100vh; overflow: hidden;
  }
  #sidebar {
    width: 250px; background: var(--sidebar-bg-light); border-right: 1px solid #ddd;
    display: flex; flex-direction: column;
    transition: background 0.3s, border-color 0.3s;
  }
  html[data-theme='dark'] #sidebar {
    background: var(--sidebar-bg-dark);
    border-color: #444;
  }
  #sidebar header {
    font-weight: 600; font-size: 1.5rem; padding: 1rem; border-bottom: 1px solid #ddd;
    user-select: none;
  }
  html[data-theme='dark'] #sidebar header {
    border-color: #444;
  }
  #sidebar nav {
    flex-grow: 1; overflow-y: auto;
  }
  #sidebar nav a {
    display: block; padding: 0.75rem 1rem; text-decoration: none; color: inherit;
    border-left: 4px solid transparent; transition: background 0.2s, border-color 0.2s;
    user-select: none;
  }
  #sidebar nav a:hover {
    background: #e1f5ec;
    border-left-color: var(--primary);
  }
  html[data-theme='dark'] #sidebar nav a:hover {
    background: #264d43;
  }
  #sidebar nav a.active {
    background: #10a37f; color: white; border-left-color: var(--primary);
  }

  /* Chat area */
  #chat-container {
    flex-grow: 1; display: flex; flex-direction: column; background: var(--background-light);
    transition: background 0.3s;
  }
  html[data-theme='dark'] #chat-container {
    background: var(--background-dark);
  }
  #messages {
    flex-grow: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 12px;
  }
  .message {
    max-width: 65%; padding: 10px 14px; border-radius: 18px; line-height: 1.4; white-space: pre-wrap;
    font-size: 1rem;
    user-select: text;
  }
  .user {
    background: var(--bubble-user-light); color: white; align-self: flex-end; border-bottom-right-radius: 4px;
  }
  html[data-theme='dark'] .user {
    background: var(--bubble-user-dark);
  }
  .bot {
    background: var(--bubble-bot-light); color: black; align-self: flex-start; border-bottom-left-radius: 4px;
  }
  html[data-theme='dark'] .bot {
    background: var(--bubble-bot-dark); color: white;
  }

  /* Input */
  #input-form {
    padding: 1rem; border-top: 1px solid #ddd; display: flex; background: var(--sidebar-bg-light);
    transition: background 0.3s, border-color 0.3s;
  }
  html[data-theme='dark'] #input-form {
    background: var(--sidebar-bg-dark);
    border-color: #444;
  }
  #input {
    flex-grow: 1; resize: none; font-size: 1rem; padding: 0.75rem 1rem; border-radius: 8px;
    border: 1px solid #ccc; outline: none;
    font-family: inherit;
    transition: border-color 0.2s;
  }
  #input:focus {
    border-color: var(--primary);
  }
  #send-btn {
    margin-left: 0.75rem; padding: 0 1.5rem; background: var(--primary); border: none; color: white;
    border-radius: 8px; font-weight: 600; cursor: pointer;
    transition: background 0.2s;
  }
  #send-btn:hover:not(:disabled) {
    background: #0e886f;
  }
  #send-btn:disabled {
    background: #8ccbc4; cursor: not-allowed;
  }

  /* Top bar */
  #top-bar {
    height: 56px; display: flex; align-items: center; justify-content: flex-end;
    border-bottom: 1px solid #ddd; padding: 0 1rem;
  }
  html[data-theme='dark'] #top-bar {
    border-color: #444;
  }
  #theme-toggle {
    background: transparent; border: none; cursor: pointer;
    color: inherit; font-size: 1.3rem;
  }

  /* Sidebar toggle button for mobile */
  #sidebar-toggle-btn {
    display: none;
    position: fixed; top: 1rem; left: 1rem; z-index: 9999;
    background: var(--primary); color: white; border: none; padding: 0.5rem;
    border-radius: 6px; cursor: pointer;
  }
  @media (max-width: 768px) {
    #sidebar {
      position: fixed; top: 0; left: 0; bottom: 0;
      transform: translateX(-100%);
      transition: transform 0.3s ease-in-out;
      z-index: 9998;
      box-shadow: 4px 0 8px rgba(0,0,0,0.2);
    }
    #sidebar.open {
      transform: translateX(0);
    }
    #sidebar-toggle-btn {
      display: block;
    }
  }

  /* Ad modal */
  #ad-modal {
    position: fixed; inset: 0; background: rgba(0,0,0,0.75);
    display: flex; align-items: center; justify-content: center;
    z-index: 10000; visibility: hidden; opacity: 0;
    transition: opacity 0.3s ease;
  }
  #ad-modal.visible {
    visibility: visible; opacity: 1;
  }
  #ad-modal-content {
    background: var(--sidebar-bg-light);
    padding: 2rem; border-radius: 12px;
    max-width: 400px; width: 90%;
    color: var(--text-light);
    text-align: center;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
    transition: background 0.3s, color 0.3s;
  }
  html[data-theme='dark'] #ad-modal-content {
    background: var(--sidebar-bg-dark);
    color: var(--text-dark);
  }
  #ad-modal button {
    margin-top: 1.5rem; padding: 0.5rem 1rem;
    background: var(--primary); border: none; color: white;
    font-weight: 600; border-radius: 6px; cursor: pointer;
  }
  #ad-modal button:disabled {
    background: #7ab6a4; cursor: not-allowed;
  }
</style>
</head>
<body>
<div id="app">
  <nav id="sidebar">
    <header>Rtqzy Tools</header>
    <nav>
      <a href="#" class="active" data-tool="chat">Chat</a>
      <a href="yt-downloader.html" target="_blank">YouTube to MP3</a>
      <a href="pdf-tools.html" target="_blank">PDF Tools</a>
      <a href="image-converter.html" target="_blank">Image Converter</a>
      <a href="qr-maker.html" target="_blank">QR Code Generator</a>
      <a href="discord-gif-maker.html" target="_blank">Discord GIF Maker</a>
      <a href="link-shortener.html" target="_blank">Link Shortener</a>
    </nav>
  </nav>

  <main id="chat-container">
    <div id="top-bar">
      <button id="sidebar-toggle-btn" title="Toggle sidebar">&#9776;</button>
      <button id="theme-toggle" title="Toggle Dark/Light Mode">ðŸŒ™</button>
    </div>

    <div id="messages" role="log" aria-live="polite" aria-atomic="false"></div>

    <form id="input-form">
      <textarea id="input" rows="1" placeholder="Type your message..."></textarea>
      <button id="send-btn" type="submit" disabled>Send</button>
    </form>
  </main>
</div>

<div id="ad-modal" role="dialog" aria-modal="true" aria-labelledby="ad-modal-title" aria-describedby="ad-modal-desc">
  <div id="ad-modal-content">
    <h2 id="ad-modal-title">Watch this ad to continue</h2>
    <p id="ad-modal-desc">Please watch the short ad below before continuing to chat.</p>
    <!-- Simulated ad -->
    <div style="background:#eee; height:150px; border-radius:8px; margin:1rem 0; display:flex; align-items:center; justify-content:center; font-weight:600; color:#666;">
      Your Ad Here
    </div>
    <button id="ad-button" disabled>Wait 5 seconds...</button>
  </div>
</div>

<script>
(() => {
  // State
  let messagesSent = 0;
  const DAILY_LIMIT = 25;
  const AD_INTERVAL = 5;
  let adRequired = false;

  // Elements
  const body = document.body;
  const sidebar = document.getElementById('sidebar');
  const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
  const themeToggleBtn = document.getElementById('theme-toggle');
  const messagesEl = document.getElementById('messages');
  const inputForm = document.getElementById('input-form');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('send-btn');
  const adModal = document.getElementById('ad-modal');
  const adButton = document.getElementById('ad-button');

  // Initialize theme from localStorage
  function loadTheme() {
    const theme = localStorage.getItem('theme') || 'light';
    body.setAttribute('data-theme', theme);
    themeToggleBtn.textContent = theme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
  }
  function toggleTheme() {
    const current = body.getAttribute('data-theme');
    const next = current === 'light' ? 'dark' : 'light';
    body.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
    themeToggleBtn.textContent = next === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
  }

  // Sidebar toggle for mobile
  sidebarToggleBtn.addEventListener('click', () => {
    sidebar.classList.toggle('open');
  });

  // Enable send button if textarea has input
  input.addEventListener('input', () => {
    sendBtn.disabled = input.value.trim().length === 0;
    // Auto resize textarea
    input.style.height = 'auto';
    input.style.height = input.scrollHeight + 'px';
  });

  // Add message to chat
  function addMessage(text, fromUser) {
    const div = document.createElement('div');
    div.classList.add('message');
    div.classList.add(fromUser ? 'user' : 'bot');
    div.textContent = text;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  // Show ad modal and force user to watch ad before continuing
  function showAdModal() {
    adModal.classList.add('visible');
    adButton.disabled = true;
    let count = 5;
    adButton.textContent = `Wait ${count} seconds...`;
    const interval = setInterval(() => {
      count--;
      if (count > 0) {
        adButton.textContent = `Wait ${count} seconds...`;
      } else {
        clearInterval(interval);
        adButton.textContent = 'I have watched the ad';
        adButton.disabled = false;
      }
    }, 1000);
  }
  function hideAdModal() {
    adModal.classList.remove('visible');
  }

  // Show error message in chat
  function showError(msg) {
    addMessage(`âš ï¸ ${msg}`, false);
  }

  // Send message handler
  inputForm.addEventListener('submit', async e => {
    e.preventDefault();
    if (adRequired) {
      alert('Please watch the ad to continue chatting.');
      showAdModal();
      return;
    }
    const question = input.value.trim();
    if (!question) return;
    addMessage(question, true);
    input.value = '';
    sendBtn.disabled = true;

    try {
      const res = await fetch('/api/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question }),
      });

      if (res.status === 402 || res.status === 403) {
        // Limit hit or ad required
        adRequired = true;
        showAdModal();
      } else if (res.ok) {
        const data = await res.json();
        addMessage(data.reply, false);
        messagesSent++;

        if (messagesSent % AD_INTERVAL === 0 || messagesSent >= DAILY_LIMIT) {
          adRequired = true;
          showAdModal();
        }
      } else {
        showError('Could not get a response from AI.');
      }
    } catch {
      showError('Network error or server unreachable.');
    }
  });

  // Ad button clicked (user confirms ad watched)
  adButton.addEventListener('click', () => {
    adRequired = false;
    hideAdModal();
    input.focus();
  });

  // Initialization
  loadTheme();
  input.focus();
})();
</script>

</body>
</html>
